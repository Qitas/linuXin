#!/bin/bash

export WorkPath=`pwd`

## Root Password
for ((i = 0; i < 5; i++)); do
	PASSWD=$(whiptail --title "LinuXin centos config" \
		--passwordbox "Enter root password. Don't use root or sudo!" \
		10 60 3>&1 1>&2 2>&3)
	if [ $i = "4" ]; then
		whiptail --title "Note QITAS" --msgbox "Invalid root Password ! " 10 40 0	
		exit 0
	fi

	sudo -k
	if sudo -lS &> /dev/null << EOF
$PASSWD
EOF
	then
		i=10
	else
		whiptail --title "LinuXin centos config" --msgbox "Invalid root Password, try again ! " \
		10 40 0	--cancel-button Exit --ok-button Retry
	fi
done

echo $PASSWD | sudo ls &> /dev/null 2>&1


OPTION=$(whiptail --title "LinuXin centos config" \
	--menu "$MENUSTR" 20 60 12 --cancel-button Finish --ok-button Select \
	"0"   "yum sources update" \
	"1"   "python3 install" \
	"2"   "system config" \
	"3"   "docker install" \
	"4"   "gitlab install" \
	"5"   "web server" \
	"6"   "mark system" \
	3>&1 1>&2 2>&3)
	

if [ $OPTION = '0' ]; then
	clear
	echo -e "yum sources update\n${Line}"
	if [ -d  $WorkPath/system ]; then
        cd $WorkPath/system
		chmod +x ./yum.sh
		sudo ./yum.sh 
	fi	
	exit 0
elif [ $OPTION = '1' ]; then
	clear
	echo -e "\npython3 install\n${Line}"
	if [ -f $WorkPath/system/python.sh ]; then
        # cd $WorkPath/system
		chmod +x system/python.sh
		sudo system/python.sh 
	fi	
	exit 0	
elif [ $OPTION = '2' ]; then
	clear
	echo -e "system config\n${Line}"
	if [ -e  $WorkPath/system/config.sh ]; then
        # cd $WorkPath/system
		chmod +x system/config.sh
		sudo system/config.sh
		echo -e "finish centos system config\n${Line}"
	fi	
	exit 0
elif [ $OPTION = "3" ]; then
	clear
	echo -e "docker install\n${Line}"
	if [ -e  $WorkPath/system/docker.sh ]; then
        # cd $WorkPath/system
		chmod +x system/docker.sh
		sudo system/docker.sh  #> docker.log
		echo -e "finish centos docker init\n${Line}"
	fi	
	exit 0
elif [ $OPTION = '4' ]; then
	clear
	echo -e "\ngitlab install\n${Line}"
	if [ -e  $WorkPath/server/gitlab.sh  ]; then
		chmod +x server/gitlab.sh 
		sudo server/gitlab.sh   #> docker.log
		echo -e "finish centos gitlab init\n${Line}"
	fi
	exit 0
elif [ $OPTION = "5" ]; then
	clear
	echo -e "\nweb server\n${Line}"
	if [ -e  $WorkPath/server/nginx.sh ]; then
		chmod +x server/nginx.sh 
		sudo server/nginx.sh   #> nginx.log
		echo -e "finish centos nginx init\n${Line}"
    	fi
	exit 0	
elif [ $OPTION = '6' ]; then
	clear
	echo -e "driver init\n${Line}"
	cd $WorkPath/mark
	sudo chmod +x mark
	sudo ./mark  #> mark.log
	echo -e "finish centos mark driver init\n${Line}"
	exit 0	
else
	whiptail --title "LinuXin centos config" \
		--msgbox "Please select correct option [0-5]" 10 50 0
	exit 0
fi



exit 0
